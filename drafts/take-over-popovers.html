<!DOCTYPE html>
<html lang="en">
<head>
  <title>Take over popovers | what's the point</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="http://hernantz.github.io/theme/css/main.css" type="text/css" />
  <link rel="stylesheet" href="http://hernantz.github.io/theme/css/fontawesome.min.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="http://hernantz.github.io/theme/css/github.css" type="text/css" />
  <link href="http://hernantz.github.io/" type="application/atom+xml" rel="alternate" title="what's the point ATOM Feed" />
  <link href="http://hernantz.github.io/images/favicon.ico" rel="icon" type="image/x-icon" />
  <link href="http://hernantz.github.io/rss.xml" type="application/atom+xml" rel="alternate" title="what's the point RSS Feed" />
  <meta name="description" content="Some strategies to reuse code in your views">
  <meta name="keywords" content="backbone, javascript, bootstrap, jquery">
  <meta name="author" content="hernantz">
</head>

<body>

  <aside class="sidebar">
    <div class="avatar centered-block">
      <a href="/"><img class="rounded-img" src="http://hernantz.github.io/images/avatar.png" height="75" width="75" /></a>
    </div>

    <div class="name centered-block">
      <a href="/">hernantz</a>
    </div>

      <section class="meta centered-block">
          <a href="http://twitter.com/hernantz" target="_blank"><i class="icon icon-twitter"></i></a>
          <a href="http://github.com/hernantz" target="_blank"><i class="icon icon-github"></i></a>
          <a href="/rss.xml" target="_blank"><i class="icon icon-rss"></i></a>
      </section>


  </aside>

        
<article class="column-right">
  <h1 class="article-title">Take over popovers</h1>
  <p class="light">
    Published
on <time datetime="2015-10-13T00:00:00-03:00">Tue 13 October 2015</time>,     under <a href="http://hernantz.github.io/category/programming.html">Programming</a>,
    tagged with <a href="http://hernantz.github.io/tag/backbone.html">backbone</a>, <a href="http://hernantz.github.io/tag/javascript.html">javascript</a>, <a href="http://hernantz.github.io/tag/bootstrap.html">bootstrap</a> and <a href="http://hernantz.github.io/tag/jquery.html">jquery</a>.
  </p>
  <p><img alt="Bootstrap 3 popovers" src="/images/popovers.png" title="Bootstrap 3 popovers" /></p>
<h2>The sorry state of jQuery plugins</h2>
<p>When adding custom widgets to enhance your web app, you'll find two possible implementation approaches:
On one the plugin does everything for you and there's the plugin that put you in charge of everything.
But of course there is a wide range in between, and by <em>everything</em> I simply mean <em>too much</em>.</p>
<p>Generally with jQuery plugins we do something like: </p>
<div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#myDiv&#39;</span><span class="p">).</span><span class="nx">jPlugin</span><span class="p">(</span><span class="nx">manyOptionsAndCallbacks</span><span class="p">);</span>
</pre></div>


<p>where we are instantiating the plugin in what could be an empty <code>div</code> or a minimal HTML structure with lots of <code>data-</code> attributes,
that will be picked up automatically by the plugin. Either way, we try to hook into some of it's functionality via options and callbacks.</p>
<p>Lets see how a jQuery mobile widget for rendering a controlgroup works: </p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">data-role=</span><span class="s">&quot;controlgroup&quot;</span> <span class="na">data-type=</span><span class="s">&quot;horizontal&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">data-role=</span><span class="s">&quot;button&quot;</span> <span class="na">data-icon=</span><span class="s">&quot;delete&quot;</span> <span class="na">data-iconpos=</span><span class="s">&quot;left&quot;</span><span class="nt">&gt;</span>Left<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p>Gets converted into this:</p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">data-role=</span><span class="s">&quot;controlgroup&quot;</span> <span class="na">data-type=</span><span class="s">&quot;horizontal&quot;</span> 
     <span class="na">class=</span><span class="s">&quot;ui-corner-all ui-controlgroup ui-controlgroup-horizontal&quot;</span> 
     <span class="na">aria-disabled=</span><span class="s">&quot;false&quot;</span> <span class="na">data-disabled=</span><span class="s">&quot;false&quot;</span> <span class="na">data-shadow=</span><span class="s">&quot;false&quot;</span> 
     <span class="na">data-corners=</span><span class="s">&quot;true&quot;</span> <span class="na">data-exclude-invisible=</span><span class="s">&quot;true&quot;</span> <span class="na">data-mini=</span><span class="s">&quot;false&quot;</span> 
     <span class="na">data-init-selector=</span><span class="s">&quot;:jqmData(role=&#39;controlgroup&#39;)&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;ui-controlgroup-controls&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;#&quot;</span> <span class="na">data-role=</span><span class="s">&quot;button&quot;</span> <span class="na">data-icon=</span><span class="s">&quot;delete&quot;</span> <span class="na">data-iconpos=</span><span class="s">&quot;left&quot;</span> 
       <span class="na">data-corners=</span><span class="s">&quot;true&quot;</span> <span class="na">data-shadow=</span><span class="s">&quot;true&quot;</span> <span class="na">data-iconshadow=</span><span class="s">&quot;true&quot;</span> 
       <span class="na">data-wrapperels=</span><span class="s">&quot;span&quot;</span> <span class="na">data-theme=</span><span class="s">&quot;c&quot;</span> 
       <span class="na">class=</span><span class="s">&quot;ui-btn ui-shadow ui-btn-corner-all ui-btn-icon-left ui-btn-up-c&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;ui-btn-inner&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;ui-btn-text&quot;</span><span class="nt">&gt;</span>Left<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">&quot;ui-icon ui-icon-delete ui-icon-shadow&quot;</span><span class="nt">&gt;</span><span class="ni">&amp;nbsp;</span><span class="nt">&lt;/span&gt;</span>
      <span class="nt">&lt;/span&gt;</span>
    <span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p>This is a plugin that is in charge of controling and drawing the widget, by doing
heavy DOM manipulation.
aquellos que separan la presentacion del control completamente donde las manipulaciones del DOM son 
menores al punto de consistir en add/remove css classes.</p>
<p>and work for simple scenarios, but when you need 
more control, you'll need to roll our own solution.
y si bien sus plugins en javascript parecen ser una exepcion, </p>
<p>Algo bueno que tiene bootstrap en el dise;o de sus widgets es 
que la estructura de los mismos se puede representar enteramente en 
markup html, sin necesidad forzosa de inicializarlos a travez de javascript.</p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;popover bottom&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;arrow&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">&quot;popover-title&quot;</span><span class="nt">&gt;</span>Popover title<span class="nt">&lt;/h3&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;popover-content&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>Popover content here.<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>


<p>The snippet above shows how to represent a popover widget. Yes, it won't be possitioned,
and won't be dismissed when you click somewhere else in the page.</p>
<h2>Taking control of your widgets</h2>
<p>Bootstrap's approach is crearly better in the sense that we can reuse it's
html markup to implement our custom widget.</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">popoverTmpl</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">&#39;&lt;div class=&quot;arrow&quot;&gt;&lt;/div&gt;&#39;</span><span class="p">,</span>
  <span class="s1">&#39;&lt;h3 class=&quot;popover-title&quot;&gt;&lt;%=title%&gt;&lt;/h3&gt;&#39;</span>

  <span class="s1">&#39;&lt;div class=&quot;popover-content&quot;&gt;&#39;</span><span class="p">,</span>
  <span class="s1">&#39;&lt;p&gt;&lt;%=content%&gt;&lt;/p&gt;&#39;</span><span class="p">,</span>
  <span class="s1">&#39;&lt;/div&gt;&#39;</span>
<span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">PopoverBottom</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">template</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">popoverTmpl</span><span class="p">),</span>
  <span class="nx">attributes</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;class&#39;</span><span class="o">:</span> <span class="s1">&#39;popover bottom&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tabindex&#39;</span><span class="o">:</span> <span class="s1">&#39;-1&#39;</span>  <span class="c1">// so that we can focus/blur</span>
  <span class="p">},</span>
  <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;blur&#39;</span><span class="o">:</span> <span class="s1">&#39;remove&#39;</span>
  <span class="p">},</span>
  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()));</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>


<p>We've got a minimum working piece of popover that we control, but it's not
possitioned. So we can make use of another library that knows how to possition
elements. In this case I'll use <a href="http://github.hubspot.com/tether/" title="Tether">Tether</a>, and modify the popover view so
that it can clean up itself before it's removed.</p>
<div class="highlight"><pre><span class="kd">var</span> <span class="nx">Popover</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">template</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">popoverTmpl</span><span class="p">),</span>
  <span class="nx">attributes</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;class&#39;</span><span class="o">:</span> <span class="s1">&#39;popover bottom fade in&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tabindex&#39;</span><span class="o">:</span> <span class="s1">&#39;-1&#39;</span>
  <span class="p">},</span>
  <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;blur&#39;</span><span class="o">:</span> <span class="s1">&#39;close&#39;</span>
  <span class="p">},</span>
  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()));</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">show</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$target</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">,</span> <span class="s1">&#39;block&#39;</span><span class="p">).</span><span class="nx">focus</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">tether</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Tether</span><span class="p">({</span>
      <span class="nx">element</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">,</span>
      <span class="nx">target</span><span class="o">:</span> <span class="nx">$target</span><span class="p">,</span>
      <span class="nx">attachment</span><span class="o">:</span> <span class="s1">&#39;top middle&#39;</span><span class="p">,</span>
      <span class="nx">targetAttachment</span><span class="o">:</span> <span class="s1">&#39;bottom middle&#39;</span>
    <span class="p">});</span>
  <span class="p">},</span>
  <span class="nx">close</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tether</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">tether</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span> <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></div>


<p>This is how we can combine Bootstrap for presentation, Backbone for logic and
Tether as a helper for possitioning elements. Live demo <a href="https://jsfiddle.net/p82fsx06/1/" title="Live demo">here</a>.</p>
<p>I believe something similar would happen with other widgets, like select2.</p>
</article>

  <footer class="column-right light">
    <hr/>
    <p>Hola internauta! If you liked the content of this blog and want to talk about it, you can find me on twitter as <a target="_blank" href="http://twitter.com/hernantz">@hernantz</a>.</p>
    <nav><a href="http://hernantz.github.io">Home</a> - <a href="http://hernantz.github.io/archives.html">Archives</a> - <a href="http://hernantz.github.io/categories.html">Categories</a> - <a href="http://hernantz.github.io/tags.html">Tags</a> - <a href="http://hernantz.github.io/rss.xml">RSS</a> | what's the point (© 2015)</nav>
    <p></p>
  </footer>

</body>
</html>