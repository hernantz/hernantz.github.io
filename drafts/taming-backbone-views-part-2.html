<!DOCTYPE html>
<html lang="en">
<head>
  <title>Taming Backbone Views: Part 2 | README.txt</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="/theme/css/main.css" type="text/css" />
  <link rel="stylesheet" media="(max-width: 750px)" href="/theme/css/mobile.css" type="text/css" />
  <link rel="stylesheet" href="/theme/css/github.css" type="text/css" />
  <link href="/images/favicon.ico" rel="icon" type="image/x-icon" />
  <link href="/rss.xml" type="application/atom+xml" rel="alternate" title="README.txt RSS Feed" />
  <meta name="description" content="Some bro tips I learned the hard way when dealing with Backbone views">
  <meta name="keywords" content="backbonejs, best-practices, javascript">
  <meta name="author" content="hernantz">
</head>

<body>

  <aside class="sidebar">
    <a href="/"><img class="rounded-img" src="/images/avatar.png" height="75" width="75" /></a>

      <nav>
        <ul>
            <li><a href="http://twitter.com/hernantz">twitter</i></a></li>
            <li><a href="http://github.com/hernantz">github</i></a></li>
            <li><a href="/whoami.html">whoami</a></li>
            <li><a href="/">blog</a></li>
        </ul>
      </nav>

  </aside>
  <main>
        
<article class="column-right">
  <h1 class="main-title">Taming Backbone Views: Part 2</h1>
  <summary>
    <p class="light">
      Published
on <time datetime="2014-08-31T15:46:00-03:00">Sun 31 August 2014</time>,       under <a href="http://hernantz.github.io/category/programming.html">Programming</a>,
      tagged with <a href="http://hernantz.github.io/tag/backbonejs.html">backbonejs</a>, <a href="http://hernantz.github.io/tag/best-practices.html">best-practices</a> and <a href="http://hernantz.github.io/tag/javascript.html">javascript</a>.
    </p>
  </summary>
  <p>Here are some bro tips I learned the hard way when dealing with Backbone views. Hopefully
will make you play nicer with Backbone Views and their workflow.</p>
<h1 id="when-to-pass-the-el-property-to-the-view">When to pass the "el" property to the view<a class="headerlink" href="#when-to-pass-the-el-property-to-the-view" title="Permanent link">&para;</a></h1>
<p>Now we know that we don't have to wait for the DOM to be loaded to interact with views.
So, except for very simple cases, don't pass the el to the view, it simply doesn't scale.</p>
<p>A view should not make any assumptions of existing DOM elements, but rather handle their 
own DOM element, and its events in an encapsulated manner.</p>
<p>If your js application is in charge of rendering the content, then it is better to not pass the <code>el</code> 
property, instead if the backend is rendering the html, the it is probably a good idea to 
do so.</p>
<p>A small example of how to deal with both is the following
<img alt="" src="/static/images/backbone-view-events.gif" /></p>
<div class="highlight"><pre><span></span><span class="c">&lt;!-- The templates we will use for each mode --&gt;</span>
<span class="nt">&lt;script</span> <span class="na">id=</span><span class="s">&quot;edit-mode&quot;</span> <span class="na">type=</span><span class="s">&quot;text/x-handlebars-template&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">value=</span><span class="s">&quot;</span><span class="cp">&lt;%=</span> <span class="n">title</span> <span class="cp">%&gt;</span><span class="s">&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">&quot;done&quot;</span><span class="nt">&gt;</span>done<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;script</span> <span class="na">id=</span><span class="s">&quot;read-mode&quot;</span> <span class="na">type=</span><span class="s">&quot;text/x-handlebars-template&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h3&gt;</span><span class="cp">&lt;%=</span> <span class="n">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">&quot;edit&quot;</span><span class="nt">&gt;</span>edit<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/script&gt;</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">// A model and a view for interacting with it</span>
<span class="kd">var</span> <span class="nx">TitleModel</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">defaults</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Lorem Ipsum&#39;</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">TitleView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">READ_MODE</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">EDIT_MODE</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;click .edit&#39;</span><span class="o">:</span> <span class="s1">&#39;onEdit&#39;</span><span class="p">,</span>
        <span class="s1">&#39;click .done&#39;</span><span class="o">:</span> <span class="s1">&#39;onDone&#39;</span>
    <span class="p">},</span>
    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">mode</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">mode</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">READ_MODE</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">readTemplate</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#read-mode&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">());</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">editTemplate</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#edit-mode&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">());</span>
    <span class="p">},</span>
    <span class="nx">onEdit</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">mode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">EDIT_MODE</span><span class="p">;</span> 
        <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">onDone</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">mode</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">READ_MODE</span><span class="p">;</span> 
        <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">());</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
    <span class="p">},</span>
    <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">mode</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">READ_MODE</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">readTemplate</span><span class="p">(</span><span class="nx">context</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">editTemplate</span><span class="p">(</span><span class="nx">context</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">// kick it off!</span>
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">titleModel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TitleModel</span><span class="p">();</span>    
    <span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TitleView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span> <span class="nx">titleModel</span><span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>


<p>Events, how are they handled internally, to access lazyly "events buble"</p>
<div class="highlight"><pre><span></span><span class="c1">// while you can do this</span>
<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// here the view will find `#selector` element</span>
    <span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">({</span><span class="nx">el</span><span class="o">:</span> <span class="s1">&#39;#selector&#39;</span><span class="p">});</span>
<span class="p">}</span>

<span class="c1">// try using a more exceptic way</span>
<span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">();</span>
<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#selector&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">$el</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<h1 id="who-is-in-charge-here">Who is in charge here?<a class="headerlink" href="#who-is-in-charge-here" title="Permanent link">&para;</a></h1>
<p>Following the encapsulation/isolation pattern of a view, the next topic is to determine who is in 
charge of controlling the view.</p>
<p>Ideally you would have a <code>controller</code> object, MarionetteJS has a component for that. But 
in plain Backbone, you usually have a "father view" that acts as one and handles it's child views.</p>
<p>Not to trigger <code>render()</code> on the view's <code>initialize()</code> method is generally a good idea. 
Instead the controlling object will take care of rendering and appending the view to 
where it belongs, when necessary.</p>
<p>It is a good practice that, to always return the object this, on methods that will be called by the 
controller object so that we gain a chainable api to manage the child view. For example, in the 
<code>render()</code> method, return the view instance and never rendered html string.</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">FatherView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="c1">// ...</span>
    <span class="nx">someMethod</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// we explicitly call the child&#39;s view render method</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.some-div&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subView</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>


<p>For each <code>on()</code> call there should be the respective <code>off()</code>. But <strong>be carefull</strong> when calling <code>off()</code>,
to give it the same params you passed to <code>on()</code> when binding the event, otherwise you'll be unbinding
<strong>all</strong> events from that object, even the ones you didn't set up.</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">SomeView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="c1">// ...</span>
    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Backbone</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;some:event&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onSomeEvent</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;some:event&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onModelEvent</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">close</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="cm">/* Not this! this.model.off(), there might be other </span>
<span class="cm">           components listening also */</span>
        <span class="nx">Backbone</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s1">&#39;some:event&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onSomeEvent</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s1">&#39;some:event&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onModelEvent</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>  <span class="c1">// always wellcome ;)</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>


<p>Better do this</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">SomeView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="c1">// ...</span>
    <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="nx">Backbone</span><span class="p">,</span> <span class="s1">&#39;some:event&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onSomeEvent</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">,</span> <span class="s1">&#39;some:event&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onModelEvent</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="nx">close</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="cm">/* This is no longer needed, </span>
<span class="cm">           call the `destroy()` method directly */</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>


<p>Views are in charge of presentation, not models.
var model.editInModal();
Instead use some kind of helper
helper.editInModal(model);</p>
<p>For communication between views, consider the following options:
<em> events happening on some shared objects (collections or models)
</em> custom events explicitly triggered (See the How-To)
* But never call from one view to another (except one of them is a subview of the other).</p>
<h1 id="todo">TODO<a class="headerlink" href="#todo" title="Permanent link">&para;</a></h1>
<ul>
<li>Recomend Building Backbone Plugins from Derek Bailey and MarionetteJS</li>
<li>Write about the Backbone.Events object and how it allows us to use listenTo, 'everything that has a trigger'
  and zombie views, close() and onClose()</li>
</ul>
</article>

      <footer class="column-right light">
        <nav><a href="/">Home</a> - <a href="/archives.html">Archives</a> - <a href="/categories.html">Categories</a> - <a href="/tags.html">Tags</a> - <a href="/rss.xml">RSS</a> | README.txt (© 2017)</nav>
      </footer>
  </main>
</body>
</html>